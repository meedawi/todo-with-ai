const translations = {
    ar: {
        language: 'ar',
        direction: 'rtl',
        appTitle: "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…",
        addNewCategory: "Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ Ø¬Ø¯ÙŠØ¯",
        addTask: "Ø£Ø¶Ù Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©",
        generateTasks: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ù ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù‡Ø§Ù…",
        loading: "Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ù...",
        inputPlaceholder: "Ø§Ø´Ø±Ø­ Ù‡Ø¯ÙÙƒ Ø¨Ø§Ù„ØªÙØµÙŠÙ„...",
        inputHint: "Ø§Ø´Ø±Ø­ Ù‡Ø¯ÙÙƒ Ø¨Ø§Ù„ØªÙØµÙŠÙ„... ÙƒÙ„Ù…Ø§ ÙƒØ§Ù† Ø§Ù„Ø´Ø±Ø­ Ø£ÙƒØ«Ø± ØªÙØµÙŠÙ„Ø§Ù‹ØŒ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ø£ÙƒØ«Ø± Ø¯Ù‚Ø© ÙˆÙ…Ø³Ø§Ø¹Ø¯Ø©.",
        errors: {
            emptyGoal: "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‡Ø¯Ù Ø£ÙˆÙ„Ø§Ù‹",
            apiError: "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ù. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
            invalidResponse: "ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ§Ù„Ø­. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."
        },
        taskStatus: {
            completed: "Ù…ÙƒØªÙ…Ù„",
            pending: "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"
        },
        buttons: {
            add: "Ø¥Ø¶Ø§ÙØ©",
            delete: "Ø­Ø°Ù",
            edit: "ØªØ¹Ø¯ÙŠÙ„",
            save: "Ø­ÙØ¸",
            cancel: "Ø¥Ù„ØºØ§Ø¡"
        },
        defaultGoal: {
            brief: '',
            detailed: ''
        },
        placeholders: {
            addTask: "Ø£Ø¶Ù Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©",
            categoryName: "Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ",
            goal: 'Ø®Ø·Ø© Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø§Ù„Ù… (Ù…Ù† ØºØ±ÙØªÙŠØŒ Ø¨Ø¯ÙˆÙ† Ù…Ù‚Ø§Ø¨Ù„Ø© Ø£Ø­Ø¯) ðŸŒ',
            detailedGoal: 'Ø£Ø±ÙŠØ¯ Ø®Ø·Ø© Ù…ÙØµÙ„Ø© Ù„Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø§Ù„Ù… ÙÙŠ Ø®Ù…Ø³ Ø³Ù†ÙˆØ§Øª Ù…Ù† ØºØ±ÙØªÙŠØŒ Ø¨Ø¯ÙˆÙ† Ù…Ù‚Ø§Ø¨Ù„Ø© Ø£Ø­Ø¯ ðŸŒ',
            category: 'Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...'
        },
        headers: {
            taskDescription: "ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©",
            subtasks: "Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ©"
        },
        tooltips: {
            taskInfo: "Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„",
            dragHandle: "Ø§Ø³Ø­Ø¨ Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªØ±ØªÙŠØ¨",
            description: "Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙˆØµÙ"
        },
        emptyState: {
            noCategories: "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØµÙ†ÙŠÙØ§Øª. Ø£Ø¶Ù ØªØµÙ†ÙŠÙØ§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ Ù„Ù„Ø¨Ø¯Ø¡!",
            noTasks: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ",
            noSubtasks: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙØ±Ø¹ÙŠØ©"
        },
        confirmDelete: {
            title: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù",
            message: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØ¬Ù…ÙŠØ¹ Ù…Ù‡Ø§Ù…Ù‡Ø§ Ø§Ù„ÙØ±Ø¹ÙŠØ©ØŸ"
        },
        languageSelector: "Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©",
        simplified: "Ù…Ø¨Ø³Ø·Ø©",
        withAI: "Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
        defaultCategories: {
            priorities: 'Ø£ÙˆÙ„ÙˆÙŠØ§Øª',
            daily: 'ÙŠÙˆÙ…ÙŠØ©',
            work: 'Ø¹Ù…Ù„',
            personal: 'Ø´Ø®ØµÙŠ',
            reading: 'Ù‚Ø±Ø§Ø¡Ø§Øª'
        },
        defaultTasks: {
            callMom: "Ø§ØªØµÙ„ Ø¨Ø£Ù…Ùƒ",
            beBetter: "ÙƒÙ† Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ø£Ù…Ø³",
            rememberGod: "Ø§Ø°ÙƒØ± Ø§Ù„Ù„Ù‡"
        }
    },
    en: {
        language: 'en',
        direction: 'ltr',
        appTitle: "Task List",
        addNewCategory: "Add New Category",
        addTask: "Add New Task",
        generateTasks: "Analyze Goal & Generate Tasks",
        loading: "Analyzing goal...",
        inputPlaceholder: "Explain your goal in detail...",
        inputHint: "Explain your goal in detail... The more detailed your explanation, the more accurate and helpful the suggested tasks will be.",
        errors: {
            emptyGoal: "Please enter your goal first",
            apiError: "An error occurred while analyzing the goal. Please try again.",
            invalidResponse: "Invalid response format. Please try again."
        },
        taskStatus: {
            completed: "Completed",
            pending: "Pending"
        },
        buttons: {
            add: "Add",
            delete: "Delete",
            edit: "Edit",
            save: "Save",
            cancel: "Cancel"
        },
        defaultGoal: {
            brief: '',
            detailed: ''
        },
        placeholders: {
            addTask: "Add new task",
            categoryName: "Category name",
            goal: 'World domination plan (from my room, without meeting anyone) ðŸŒ',
            detailedGoal: 'I need a detailed 5-year plan to rule the world from my room, without meeting anyone ðŸŒ',
            category: 'New category name...'
        },
        headers: {
            taskDescription: "Task Details",
            subtasks: "Subtasks"
        },
        tooltips: {
            taskInfo: "View Details",
            dragHandle: "Drag to reorder",
            description: "Click to view description"
        },
        emptyState: {
            noCategories: "No categories. Add a new category to get started!",
            noTasks: "No tasks in this category",
            noSubtasks: "No subtasks"
        },
        confirmDelete: {
            title: "Confirm Delete",
            message: "Are you sure you want to delete this task and all its subtasks?"
        },
        languageSelector: "Select Language",
        simplified: "Simplified",
        withAI: "with AI",
        defaultCategories: {
            priorities: 'Priorities',
            daily: 'Daily',
            work: 'Work',
            personal: 'Personal',
            reading: 'Reading'
        },
        defaultTasks: {
            callMom: "Call your mother",
            beBetter: "Be better than yesterday",
            rememberGod: "Remember God"
        }
    },
    es: {
        language: 'es',
        direction: 'ltr',
        appTitle: "Lista de Tareas",
        addNewCategory: "AÃ±adir Nueva CategorÃ­a",
        addTask: "AÃ±adir Nueva Tarea",
        generateTasks: "Analizar Objetivo y Generar Tareas",
        loading: "Analizando objetivo...",
        inputPlaceholder: "Explica tu objetivo en detalle...",
        inputHint: "Explica tu objetivo en detalle... Cuanto mÃ¡s detallada sea tu explicaciÃ³n, mÃ¡s precisas y Ãºtiles serÃ¡n las tareas sugeridas.",
        errors: {
            emptyGoal: "Por favor, introduce tu objetivo primero",
            apiError: "OcurriÃ³ un error al analizar el objetivo. Por favor, intÃ©ntalo de nuevo.",
            invalidResponse: "Formato de respuesta invÃ¡lido. Por favor, intÃ©ntalo de nuevo."
        },
        taskStatus: {
            completed: "Completado",
            pending: "Pendiente"
        },
        buttons: {
            add: "AÃ±adir",
            delete: "Eliminar",
            edit: "Editar",
            save: "Guardar",
            cancel: "Cancelar"
        },
        defaultGoal: {
            brief: '',
            detailed: ''
        },
        placeholders: {
            addTask: "AÃ±adir nueva tarea",
            categoryName: "Nombre de categorÃ­a",
            goal: 'Plan de dominaciÃ³n mundial (desde mi habitaciÃ³n, sin ver a nadie) ðŸŒ',
            detailedGoal: 'Necesito un plan detallado de 5 aÃ±os para dominar el mundo desde mi habitaciÃ³n, sin ver a nadie ðŸŒ',
            category: 'Nombre de nueva categorÃ­a...'
        },
        headers: {
            taskDescription: "Detalles de la Tarea",
            subtasks: "Subtareas"
        },
        tooltips: {
            taskInfo: "Mostrar detalles",
            dragHandle: "Arrastra para reordenar",
            description: "Haz clic para ver la descripciÃ³n"
        },
        emptyState: {
            noCategories: "No hay categorÃ­as. Â¡AÃ±ade una nueva categorÃ­a para empezar!",
            noTasks: "No hay tareas en esta categorÃ­a",
            noSubtasks: "No hay subtareas"
        },
        confirmDelete: {
            title: "Confirmar EliminaciÃ³n",
            message: "Â¿EstÃ¡s seguro de que deseas eliminar esta tarea y todas sus subtareas?"
        },
        languageSelector: "Seleccionar Idioma",
        simplified: "Simplificada",
        withAI: "con IA",
        defaultCategories: {
            priorities: 'Prioridades',
            daily: 'Diario',
            work: 'Trabajo',
            personal: 'Personal',
            reading: 'Lectura'
        },
        defaultTasks: {
            callMom: "Llama a tu madre",
            beBetter: "SÃ© mejor que ayer",
            rememberGod: "Recuerda a Dios"
        }
    },
    fr: {
        language: 'fr',
        direction: 'ltr',
        appTitle: "Liste des TÃ¢ches",
        addNewCategory: "Ajouter une Nouvelle CatÃ©gorie",
        addTask: "Ajouter une Nouvelle TÃ¢che",
        generateTasks: "Analyser l'Objectif et GÃ©nÃ©rer des TÃ¢ches",
        loading: "Analyse de l'objectif...",
        inputPlaceholder: "Expliquez votre objectif en dÃ©tail...",
        inputHint: "Expliquez votre objectif en dÃ©tail... Plus votre explication sera dÃ©taillÃ©e, plus les tÃ¢ches suggÃ©rÃ©es seront prÃ©cises et utiles.",
        errors: {
            emptyGoal: "Veuillez d'abord saisir votre objectif",
            apiError: "Une erreur s'est produite lors de l'analyse de l'objectif. Veuillez rÃ©essayer.",
            invalidResponse: "Format de rÃ©ponse invalide. Veuillez rÃ©essayer."
        },
        taskStatus: {
            completed: "TerminÃ©",
            pending: "En cours"
        },
        buttons: {
            add: "Ajouter",
            delete: "Supprimer",
            edit: "Modifier",
            save: "Enregistrer",
            cancel: "Annuler"
        },
        defaultGoal: {
            brief: '',
            detailed: ''
        },
        placeholders: {
            addTask: "Ajouter une nouvelle tÃ¢che",
            categoryName: "Nom de la catÃ©gorie",
            goal: 'Plan de domination mondiale (depuis ma chambre, sans voir personne) ðŸŒ',
            detailedGoal: 'J\'ai besoin d\'un plan dÃ©taillÃ© sur 5 ans pour dominer le monde depuis ma chambre, sans voir personne ðŸŒ',
            category: 'Nom de nouvelle catÃ©gorie...'
        },
        headers: {
            taskDescription: "DÃ©tails de la TÃ¢che",
            subtasks: "Sous-tÃ¢ches"
        },
        tooltips: {
            taskInfo: "Afficher les dÃ©tails",
            dragHandle: "Faire glisser pour rÃ©organiser",
            description: "Cliquez pour afficher la description"
        },
        emptyState: {
            noCategories: "Aucune catÃ©gorie. Ajoutez une nouvelle catÃ©gorie pour commencer !",
            noTasks: "Aucune tÃ¢che dans cette catÃ©gorie",
            noSubtasks: "Aucune sous-tÃ¢che"
        },
        confirmDelete: {
            title: "Confirmer la Suppression",
            message: "ÃŠtes-vous sÃ»r de vouloir supprimer cette tÃ¢che et toutes ses sous-tÃ¢ches ?"
        },
        languageSelector: "SÃ©lectionner la Langue",
        simplified: "SimplifiÃ©e",
        withAI: "avec l'IA",
        defaultCategories: {
            priorities: 'PrioritÃ©s',
            daily: 'Quotidien',
            work: 'Travail',
            personal: 'Personnel',
            reading: 'Lecture'
        },
        defaultTasks: {
            callMom: "Appelle ta mÃ¨re",
            beBetter: "Sois meilleur qu'hier",
            rememberGod: "Souviens-toi de Dieu"
        }
    },
    zh: {
        language: 'zh',
        direction: 'ltr',
        appTitle: "ä»»åŠ¡æ¸…å•",
        addNewCategory: "æ·»åŠ æ–°ç±»åˆ«",
        addTask: "æ·»åŠ æ–°ä»»åŠ¡",
        generateTasks: "åˆ†æžç›®æ ‡å¹¶ç”Ÿæˆä»»åŠ¡",
        loading: "æ­£åœ¨åˆ†æžç›®æ ‡...",
        inputPlaceholder: "è¯¦ç»†è¯´æ˜Žæ‚¨çš„ç›®æ ‡...",
        inputHint: "è¯¦ç»†è¯´æ˜Žæ‚¨çš„ç›®æ ‡...è§£é‡Šè¶Šè¯¦ç»†ï¼Œå»ºè®®çš„ä»»åŠ¡å°±è¶Šå‡†ç¡®å’Œæœ‰å¸®åŠ©ã€‚",
        errors: {
            emptyGoal: "è¯·å…ˆè¾“å…¥æ‚¨çš„ç›®æ ‡",
            apiError: "åˆ†æžç›®æ ‡æ—¶å‡ºé”™ã€‚è¯·é‡è¯•ã€‚",
            invalidResponse: "æ— æ•ˆçš„å“åº”æ ¼å¼ã€‚è¯·é‡è¯•ã€‚"
        },
        taskStatus: {
            completed: "å·²å®Œæˆ",
            pending: "è¿›è¡Œä¸­"
        },
        buttons: {
            add: "æ·»åŠ ",
            delete: "åˆ é™¤",
            edit: "ç¼–è¾‘",
            save: "ä¿å­˜",
            cancel: "å–æ¶ˆ"
        },
        defaultGoal: {
            brief: '',
            detailed: ''
        },
        placeholders: {
            addTask: "æ·»åŠ æ–°ä»»åŠ¡",
            categoryName: "ç±»åˆ«åç§°",
            goal: 'ä¸–ç•Œç»Ÿæ²»è®¡åˆ’ï¼ˆåœ¨æˆ‘æˆ¿é—´é‡Œï¼Œä¸è§ä»»ä½•äººï¼‰ðŸŒ',
            detailedGoal: 'æˆ‘éœ€è¦ä¸€ä¸ªä»Žæˆ¿é—´é‡Œç»Ÿæ²»ä¸–ç•Œçš„äº”å¹´è¯¦ç»†è®¡åˆ’ï¼Œæ— éœ€è§ä»»ä½•äºº ðŸŒ',
            category: 'æ–°ç±»åˆ«åç§°...'
        },
        headers: {
            taskDescription: "ä»»åŠ¡è¯¦æƒ…",
            subtasks: "å­ä»»åŠ¡"
        },
        tooltips: {
            taskInfo: "æ˜¾ç¤ºè¯¦æƒ…",
            dragHandle: "æ‹–åŠ¨ä»¥é‡æ–°æŽ’åº",
            description: "ç‚¹å‡»æŸ¥çœ‹æè¿°"
        },
        emptyState: {
            noCategories: "æ²¡æœ‰ç±»åˆ«ã€‚æ·»åŠ æ–°ç±»åˆ«å¼€å§‹ï¼",
            noTasks: "æ­¤ç±»åˆ«ä¸­æ²¡æœ‰ä»»åŠ¡",
            noSubtasks: "æ²¡æœ‰å­ä»»åŠ¡"
        },
        confirmDelete: {
            title: "ç¡®è®¤åˆ é™¤",
            message: "æ‚¨ç¡®å®šè¦åˆ é™¤æ­¤ä»»åŠ¡å’Œæ‰€æœ‰å­ä»»åŠ¡å—ï¼Ÿ"
        },
        languageSelector: "é€‰æ‹©è¯­è¨€",
        simplified: "ç®€åŒ–ç‰ˆ",
        withAI: "ä½¿ç”¨äººå·¥æ™ºèƒ½",
        defaultCategories: {
            priorities: 'ä¼˜å…ˆäº‹é¡¹',
            daily: 'æ¯æ—¥',
            work: 'å·¥ä½œ',
            personal: 'ä¸ªäºº',
            reading: 'é˜…è¯»'
        },
        defaultTasks: {
            callMom: "ç»™å¦ˆå¦ˆæ‰“ç”µè¯",
            beBetter: "æ¯”æ˜¨å¤©æ›´å¥½",
            rememberGod: "è®°ä½ä¸Šå¸"
        }
    }
};

// Get user's browser language
function getBrowserLanguage() {
    const defaultLanguage = 'en';
    const browserLang = navigator.language.split('-')[0];
    return translations[browserLang] ? browserLang : defaultLanguage;
}

// Get or set current language from storage
async function getCurrentLanguage() {
    const result = await chrome.storage.sync.get('language');
    return result.language || getBrowserLanguage();
}

// Set language in storage
async function setLanguage(language) {
    await chrome.storage.sync.set({ language });
    return language;
}

// Get translation for current language
async function getTranslation() {
    const currentLang = await getCurrentLanguage();
    return translations[currentLang] || translations.en;
}

// Update all UI elements with new language
async function updateUILanguage() {
    const translation = await getTranslation();
    
    // Update direction based on language
    document.documentElement.dir = translation.direction || 'ltr';
    document.body.dir = translation.direction || 'ltr';
    
    // Update static UI elements
    document.getElementById('appTitle').textContent = translation.appTitle;
    document.getElementById('addCategoryBtn').textContent = translation.addNewCategory;
    document.getElementById('generateTasks').textContent = translation.generateTasks;
    document.getElementById('goalInput').placeholder = translation.inputPlaceholder;
    document.querySelector('.input-hint').textContent = translation.inputHint;
    document.querySelector('.loading p').textContent = translation.loading;
    
    // Update any existing tasks status text
    document.querySelectorAll('.task-status').forEach(status => {
        const isCompleted = status.closest('.task').querySelector('input[type="checkbox"]').checked;
        status.textContent = isCompleted ? translation.taskStatus.completed : translation.taskStatus.pending;
    });
    
    // Update mode buttons
    const modeBtns = document.querySelectorAll('.mode-btn');
    modeBtns.forEach(btn => {
        const mode = btn.dataset.mode;
        if (mode === 'simple') {
            btn.textContent = translation.simplified;
        } else if (mode === 'ai') {
            btn.textContent = translation.withAI;
        }
    });
}
